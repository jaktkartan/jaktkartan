<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jaktkartan.se</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/suncalc/suncalc.js"></script>
    <script src="vaderprognos.js"></script>
    <script src="iframeHandler.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .leaflet-top.leaflet-left {
            top: 80px !important;
            left: 10px !important;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <a href="http://www.jaktkartan.se" style="position: fixed; top: 15px; left: 10px; z-index: 9999;">
        <img src="bilder/ikon3.png" alt="Jaktkartan.se" style="width: 50px; height: auto;">
    </a>
    <div id="info-panel">
        <div id="accuracy">Lägesnoggrannhet: Unknown</div>
        <div id="sunrise-sunset">
            <img id="sunrise-icon" src="https://raw.githubusercontent.com/timothylevin/Testmiljo/main/sunrise.png" alt="Sunrise Icon" style="height: 24px;">
            <span id="sunrise"></span>
            <img id="sunset-icon" src="https://raw.githubusercontent.com/timothylevin/Testmiljo/main/sunset.png" alt="Sunset Icon" style="height: 24px;">
            <span id="sunset"></span>
            <div class="expand-toggle" onclick="togglePanel()">Väderprognos <span class="arrow">&#9660;</span></div>
            <div id="weather-info" style="display: none;">
                <div id="weather-text">Laddar väder...</div>
            </div>
        </div>
    </div>
    <div id="map"></div>
    <div id="bottom-panel">
        <button class="panel-button" onclick="openTab('tab1', 'bottom_panel/upptack.html')"><img src="https://raw.githubusercontent.com/timothylevin/Testmiljo/main/bilder/upptack.png" alt="Upptäck"></button>
        <button class="panel-button" onclick="openTab('tab2', 'bottom_panel/kartor.html')"><img src="https://raw.githubusercontent.com/timothylevin/Testmiljo/main/bilder/kartor.png" alt="Kartor"></button>
        <button class="panel-button" onclick="openTab('tab3', 'bottom_panel/jaktbart_idag.html')"><img src="https://raw.githubusercontent.com/timothylevin/Testmiljo/main/bilder/jaktbart idag.png" alt="Jaktbart idag"></button>
        <button class="panel-button" onclick="openTab('tab4', 'bottom_panel/kaliberkrav.html')"><img src="https://raw.githubusercontent.com/timothylevin/Testmiljo/main/bilder/kaliberkrav.png" alt="Kaliberkrav"></button>
        <button class="panel-button" onclick="openTab('tab5', 'bottom_panel/jaktkollen.html')"><img src="https://raw.githubusercontent.com/timothylevin/Testmiljo/main/bilder/jaktkollen.png" alt="Jaktkollen"></button>
    </div>
    <div id="tab-content" style="display:none;">
        <div id="tab1" class="tab-pane"></div>
        <div id="tab2" class="tab-pane"></div>
        <div id="tab3" class="tab-pane"></div>
        <div id="tab4" class="tab-pane"></div>
        <div id="tab5" class="tab-pane"></div>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
    function resetTabs() {
        var tabs = document.getElementsByClassName('tab-pane');
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].style.display = 'none';
            tabs[i].innerHTML = '';
        }
        var tabContent = document.getElementById('tab-content');
        tabContent.style.display = 'none';
    }
    document.addEventListener('click', function(event) {
        var tabContent = document.getElementById('tab-content');
        if (!tabContent.contains(event.target) && !event.target.matches('.panel-button img')) {
            resetTabs();
        }
    });
    function togglePanel() {
        var weatherInfo = document.getElementById('weather-info');
        if (weatherInfo.style.display === 'none') {
            weatherInfo.style.display = 'block';
            navigator.geolocation.getCurrentPosition(function (position) {
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;
                getWeatherForecast(latitude, longitude);
            });
        } else {
            weatherInfo.style.display = 'none';
        }
    }
    function openTab(tabId, filePath) {
        var tabContent = document.getElementById('tab-content');
        var tabs = document.getElementsByClassName('tab-pane');
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].style.display = 'none';
        }
        var activeTab = document.getElementById(tabId);
        activeTab.style.display = 'block';
        tabContent.style.display = 'block';
        axios.get(filePath)
            .then(function (response) {
                activeTab.innerHTML = response.data;
            })
            .catch(function (error) {
                console.log("Error fetching content for tab:", tabId, "Error message:", error.message);
            });
    }
    function closeTabContent() {
        var tabContent = document.getElementById('tab-content');
        tabContent.style.display = 'none';
    }
    document.addEventListener('click', function(event) {
        var tabContent = document.getElementById('tab-content');
        if (!tabContent.contains(event.target) && !event.target.matches('.panel-button img')) {
            closeTabContent();
        }
    });
    document.addEventListener("DOMContentLoaded", function() {
        var map = L.map('map', {
            zoomControl: false
        }).setView([62.0, 15.0], 5);
        L.control.zoom({
            position: 'topright'
        }).addTo(map);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        axios.get('https://raw.githubusercontent.com/timothylevin/Testmiljo/main/Upptack/upptack.geojson')
            .then(function (response) {
                console.log("Successfully fetched GeoJSON data:", response.data);
                var geojsonLayer = L.geoJSON(response.data);
                geojsonLayer.addTo(map); // Detta säkerställer att geojsonLayer läggs till i kartan
            })
            .catch(function (error) {
                console.log("Error fetching GeoJSON data:", error.message);
            });
        var markerIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/timothylevin/Testmiljo/main/bilder/marker.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41]
        });
        var marker = L.marker([62.0, 15.0], { icon: markerIcon }).addTo(map);
        navigator.geolocation.watchPosition(function (position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            var accuracy = position.coords.accuracy;
            var accuracyDiv = document.getElementById('accuracy');
            accuracyDiv.textContent = 'Lägesnoggrannhet: ' + accuracy + ' meter';
            marker.setLatLng([latitude, longitude]);
            map.setView([latitude, longitude]);
        });
        navigator.geolocation.getCurrentPosition(function (position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            var times = SunCalc.getTimes(new Date(), latitude, longitude);
            var sunrise = times.sunrise.getHours() + ':' + ('0' + times.sunrise.getMinutes()).slice(-2);
            var sunset = times.sunset.getHours() + ':' + ('0' + times.sunset.getMinutes()).slice(-2);
            document.getElementById('sunrise').textContent = sunrise;
            document.getElementById('sunset').textContent = sunset;
        });
    });
    </script>
</body>
</html>
